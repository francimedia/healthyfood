{% extends "layouts/manager.twig" %}

{% block title %}Index{% endblock %}

{% block head %}
    {{ parent() }}


{% endblock %}


{% block content %}
	
	<div id="container" style="height: 500px; min-width: 500px"></div>
{% endblock %}
    

{% block scripts %} 
    {{ parent() }}

	<script src="http://code.highcharts.com/stock/highstock.js"></script>
	<script src="http://code.highcharts.com/stock/modules/exporting.js"></script>

	<script type="text/javascript">

$(function() {
	var seriesOptions = [],
		yAxisOptions = [],
		seriesCounter = 0,
		items = [
			{
				id: 3461,
				name: 'Austin Convention Center'
			},
			{
				id: 3718,
				name: 'Whole Foods Market'
			},
			{
				id: 3367,
				name: 'The Driskill'
			},
			{
				id: 3400,
				name: 'Hilton Austin'
			},
			{
				id: 3673,
				name: 'W Austin'
			} 
		],
		colors = Highcharts.getOptions().colors;

	$.each(items, function(i, item) {

		// $.getJSON('http://www.highcharts.com/samples/data/jsonp.php?filename='+ name.toLowerCase() +'-c.json&callback=?',	function(data) {
		$.getJSON('/manager/api/records.json?timespan=day&properties=checkin&ids='+ item.id +'&datatype=absolute',	function(data) {

			seriesOptions[i] = {
				name: item.name,
				data: data
			};

			// As we're loading the data asynchronously, we don't know what order it will arrive. So
			// we keep a counter and create the chart when all the data is loaded.
			seriesCounter++;

			if (seriesCounter == items.length) {
				createChart();
			}
		});
	});



	// create the chart when all data is loaded
	function createChart() {

		chart = new Highcharts.StockChart({
		    chart: {
		        renderTo: 'container'
		    },

		    rangeSelector: {
		        selected: 4
		    },

		    yAxis: {
		    	labels: {
		    		formatter: function() {
		    			return (this.value > 0 ? '+' : '') + this.value + '%';
		    		}
		    	},
		    	plotLines: [{
		    		value: 0,
		    		width: 2,
		    		color: 'silver'
		    	}]
		    },
		    
		    plotOptions: {
		     	series: {
		     		compare: 'percent'
		     	}
		    },
		    
		    tooltip: {
		    	pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',
		    	valueDecimals: 2
		    },
		    
		    series: seriesOptions
		});
	}

});


	</script>
{% endblock %}
